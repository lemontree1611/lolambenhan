<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- ===== BASIC SEO ===== -->
    <meta name="description" content="LoLamBenhAn ‚Äì C√¥ng c·ª• h·ªó tr·ª£ sinh vi√™n Y khoa l√†m b·ªánh √°n n·ªôi khoa, ngo·∫°i khoa, s·∫£n, nhi nhanh ch√≥ng, ch√≠nh x√°c v√† d·ªÖ s·ª≠ d·ª•ng.">
    <meta name="keywords" content="l√†m b·ªánh √°n, b·ªánh √°n y khoa, sinh vi√™n y khoa, b·ªánh √°n n·ªôi khoa, b·ªánh √°n ngo·∫°i khoa, ti·ªÅn ph·∫´u, h·∫≠u ph·∫´u, s·∫£n khoa, ph·ª• khoa, nhi khoa">
    <meta name="author" content="LoLamBenhAn">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://lolambenhan.vercel.app/">
    
    <!-- ===== OPEN GRAPH (Facebook, Zalo, LinkedIn...) ===== -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="LoLamBenhAn ‚Äì H·ªó tr·ª£ sinh vi√™n Y khoa l√†m b·ªánh √°n nhanh ch√≥ng">
    <meta property="og:description" content="N·ªÅn t·∫£ng h·ªó tr·ª£ sinh vi√™n Y khoa l·∫≠p b·ªánh √°n nhanh, g·ªçn, ƒë√∫ng chu·∫©n: n·ªôi khoa, ti·ªÅn ph·∫´u, h·∫≠u ph·∫´u, s·∫£n ‚Äì ph·ª• ‚Äì nhi khoa.">
    <meta property="og:url" content="https://lolambenhan.vercel.app/">
    <meta property="og:image" content="https://lolambenhan.vercel.app/source/preview.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="vi_VN">
    <meta property="og:site_name" content="LoLamBenhAn">
    
    <!-- ===== TWITTER CARD ===== -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="LoLamBenhAn ‚Äì H·ªó tr·ª£ sinh vi√™n Y khoa l√†m b·ªánh √°n">
    <meta name="twitter:description" content="C√¥ng c·ª• h·ªó tr·ª£ sinh vi√™n Y khoa l√†m b·ªánh √°n nhanh, chu·∫©n, d·ªÖ d√πng cho h·ªçc t·∫≠p v√† th·ª±c h√†nh l√¢m s√†ng.">
    <meta name="twitter:image" content="https://lolambenhan.vercel.app/source/preview.jpg">

    <link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQmj7drT8_gPK2zwTd5CMdWRNdIQmHNP2T9Kg&s">
    <title>LoLamBenhAn - H·ªó tr·ª£ sinh vi√™n Y khoa l√†m b·ªánh √°n nhanh ch√≥ng</title>
    <script defer src="https://cloud.umami.is/script.js" data-website-id="d50ebc58-08ea-422c-bb38-4a34b3f50862"></script>
    <link rel="stylesheet" href="source/trangchu.css?v=1.0.2">

    <style>
        /* Admin delete button (fallback styles if CSS file doesn't define it) */
        .comment-actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
        .delete-admin-btn{
            appearance:none; border:0; cursor:pointer;
            padding:8px 12px; border-radius:12px;
            background: rgba(255, 59, 48, .12);
            color: rgba(255, 59, 48, .95);
            font-weight: 700;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform .12s ease, background .12s ease;
        }
        .delete-admin-btn:hover{background: rgba(255, 59, 48, .18); transform: translateY(-1px);}
        .delete-admin-btn:active{transform: translateY(0);}
        .delete-admin-btn[disabled]{opacity:.6; cursor:not-allowed; transform:none;}
    </style>

</head>
<body>
    <div class="bg-fixed" aria-hidden="true"></div>


<!-- ===== ADMIN ANNOUNCEMENT POPUP (HARDCODE) ===== -->
<div class="announce-backdrop" id="announce-modal" aria-hidden="false">
    <div class="announce-modal" role="dialog" aria-modal="true" aria-labelledby="announce-title" aria-describedby="announce-desc">
        <div class="announce-header">
            <div>
                <div class="announce-title" id="announce-title">Th√¥ng b√°o t·ª´ Admin</div>
                <div class="announce-sub">C·∫≠p nh·∫≠t m·ªõi nh·∫•t</div>
            </div>
            <button class="announce-close" type="button" id="announce-close" aria-label="ƒê√≥ng">‚úï</button>
        </div>

        <div class="announce-body" id="announce-desc">
            <p class="announce-message">
                üì¢ C·∫ßn c√°c b·∫°n g·ª≠i form chu·∫©n b·ªánh √°n <b>YHCT, RHM, GMHS...</b> ƒë·ªÉ m√¨nh th√™m cho m·ªçi ng∆∞·ªùi c√πng l√†m. G·ª≠i tr·ª±c ti·∫øp <b>file word / link gg doc</b> nha, xin c·∫£m ∆°n! FB: https://facebook.com/lemontree1611
            </p>
            <div class="announce-actions">
                <button class="announce-btn" type="button" id="announce-ok">ƒê√≥ng</button>
            </div>
        </div>
    </div>
</div>
<!-- ============================================ -->


    <!-- Admin login button (Liquid Glass) - g√≥c ph·∫£i -->
    <div class="admin-widget">
        <button class="admin-btn admin-btn--icon" id="admin-btn" type="button" title="Admin login">
            <span class="admin-dot" id="admin-dot" aria-hidden="true"></span>
            <svg class="admin-icon" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <defs>
                    <linearGradient id="lg" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0" stop-color="rgba(10,132,255,.85)"/>
                        <stop offset="1" stop-color="rgba(175,82,222,.75)"/>
                    </linearGradient>
                </defs>
                <path d="M12 2c2.4 0 4.4 2 4.4 4.4V9h1.2c1.3 0 2.4 1.1 2.4 2.4v7c0 1.3-1.1 2.4-2.4 2.4H6.4C5.1 20.8 4 19.7 4 18.4v-7C4 10.1 5.1 9 6.4 9h1.2V6.4C7.6 4 9.6 2 12 2zm2 7V6.4C14 5.1 13 4.1 11.7 4.1S9.4 5.1 9.4 6.4V9H14z" fill="url(#lg)"/>
                <path d="M12 12.2c.9 0 1.6.7 1.6 1.6 0 .6-.3 1.1-.8 1.4v1.6c0 .4-.4.8-.8.8s-.8-.4-.8-.8v-1.6c-.5-.3-.8-.8-.8-1.4 0-.9.7-1.6 1.6-1.6z" fill="rgba(255,255,255,.92)"/>
            </svg>
            <span id="admin-text" class="admin-text">Admin</span>
        </button>
    </div>

    <!-- Admin modal -->
    <div class="modal-backdrop" id="admin-modal" aria-hidden="true">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <div class="modal-title">Admin login</div>
                    <div class="modal-sub" id="admin-sub">ƒêƒÉng nh·∫≠p ƒë·ªÉ m·ªü kh√≥a t√≠nh nƒÉng</div>
                </div>
                <button class="icon-btn" type="button" id="admin-close" aria-label="Close">‚úï</button>
            </div>

            <div class="modal-body">
                <div class="form-group" id="pw-wrap">
                    <label>M·∫≠t kh·∫©u</label>
                    <input type="password" id="admin-password" placeholder="12345678" autocomplete="current-password">
                </div>
                <div class="modal-actions">
                    <button class="submit-btn" type="button" id="admin-login-btn">ƒêƒÉng nh·∫≠p</button>
                    <button class="ghost-btn" type="button" id="admin-logout-btn" style="display:none">ƒêƒÉng xu·∫•t</button>
                </div>
                <div class="modal-note" id="admin-note"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>LoLamBenhAn</h1>
            <p class="subtitle">H·ªó tr·ª£ sinh vi√™n Y khoa l√†m b·ªánh √°n nhanh ch√≥ng</p>
        </header>

        <div class="card-grid">
            <a href="noikhoa/" class="card"><h3>N·ªôi khoa</h3><p>B·ªánh √°n n·ªôi khoa</p></a>
            <a href="tienphau/" class="card"><h3>Ti·ªÅn ph·∫´u</h3><p>B·ªánh √°n ti·ªÅn ph·∫´u thu·∫≠t</p></a>
            <a href="hauphau/" class="card"><h3>H·∫≠u ph·∫´u</h3><p>B·ªánh √°n h·∫≠u ph·∫´u thu·∫≠t</p></a>
            <a href="sankhoa/" class="card"><h3>S·∫£n khoa</h3><p>B·ªánh √°n s·∫£n khoa</p></a>
            <a href="phukhoa/" class="card"><h3>Ph·ª• khoa</h3><p>B·ªánh √°n ph·ª• khoa</p></a>
            <a href="nhikhoa/" class="card"><h3>Nhi khoa</h3><p>B·ªánh √°n nhi khoa</p></a>
        </div>

        <!-- Comments Section -->
        <div class="comments-section">
            <h2 class="comments-title">G√≥p √Ω cho Admin</h2>

            <div class="comment-form">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="username" placeholder="Nh·∫≠p nickname c·ªßa b·∫°n">
                </div>
                <div class="form-group">
                    <label>N·ªôi dung g√≥p √Ω</label>
                    <textarea id="comment-text" placeholder="Vi·∫øt g√≥p √Ω c·ªßa b·∫°n..."></textarea>
                </div>
                <button class="submit-btn" id="submit-btn" onclick="addComment()">G·ª≠i g√≥p √Ω</button>
            </div>

            <div class="comments-list" id="comments-list">
                <div class="loading">ƒêang t·∫£i g√≥p √Ω...</div>
            </div>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <footer>
        <p>Copyright ¬© 2025 Lolambenhan. All rights reserved.</p>
    </footer>

    <script>
        /* ================== CONFIG ================== */
        // üî¥ S·ª¨A LINK BACKEND RENDER ·ªû ƒê√ÇY
        const API_BASE = "https://lolambenhan.onrender.com";
        /* =========================================== */

        let comments = [];
        let currentPage = 1;
        const commentsPerPage = 5;

        // Admin token l∆∞u local (ƒë∆°n gi·∫£n ƒë√∫ng nh∆∞ b·∫°n mu·ªën)
        let adminToken = localStorage.getItem('admin_token') || '';
        let isAdmin = !!adminToken;

        async function loadComments() {
            try {
                const response = await fetch(`${API_BASE}/comments`, { cache: 'no-store' });
                const data = await response.json();

                if (response.ok && Array.isArray(data)) {
                    comments = data;
                } else {
                    comments = [];
                }
            } catch (error) {
                console.error('L·ªói khi t·∫£i g√≥p √Ω:', error);
                comments = [];
            }
            // isAdmin d·ª±a tr√™n token local
            isAdmin = !!adminToken;
            syncAdminUI();
            renderComments();
        }

        async function addComment() {
            const username = document.getElementById('username').value.trim();
            const text = document.getElementById('comment-text').value.trim();
            const submitBtn = document.getElementById('submit-btn');

            if (!username) {
                alert('Vui l√≤ng nh·∫≠p nickname c·ªßa b·∫°n');
                return;
            }
            if (!text) {
                alert('Vui l√≤ng nh·∫≠p n·ªôi dung g√≥p √Ω');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'ƒêang g·ª≠i...';

            try {
                const response = await fetch(`${API_BASE}/comments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, text })
                });

                const data = await response.json().catch(() => ({}));

                if (response.ok && (data.ok || data.success)) {
                    document.getElementById('username').value = '';
                    document.getElementById('comment-text').value = '';
                    currentPage = 1;
                    await loadComments();
                } else {
                    alert('L·ªói: ' + (data.error || 'Kh√¥ng th·ªÉ g·ª≠i g√≥p √Ω'));
                }
            } catch (error) {
                console.error('L·ªói khi g·ª≠i g√≥p √Ω:', error);
                alert('Kh√¥ng th·ªÉ g·ª≠i g√≥p √Ω. Vui l√≤ng th·ª≠ l·∫°i!');
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'G·ª≠i g√≥p √Ω';
        }

        function renderHeartControls(comment){
            // Admin: hi·ªán n√∫t b·∫•m ‚ô• + n√∫t x√≥a
            if (isAdmin) {
                return `
                    <div class="comment-actions">
                        <button class="heart-admin-btn ${comment.heart ? 'active' : ''}" type="button"
                            title="${comment.heart ? 'B·ªè tim' : 'Th·∫£ tim'}"
                            onclick="toggleHeart(${comment.id})">
                            <span class="heart-admin-text" aria-hidden="true">‚ô• Admin</span>
                        </button>

                        <button class="delete-admin-btn" type="button"
                            title="X√≥a g√≥p √Ω"
                            onclick="deleteComment(${comment.id}, this)">
                            üóë X√≥a
                        </button>
                    </div>
                `;
            }
            // User th∆∞·ªùng: ch·ªâ xem ‚ô• n·∫øu ƒë√£ ƒë∆∞·ª£c admin th·∫£
            if (comment.heart) {
                return `
                    <div class="comment-actions">
                        <span class="heart-admin-view" aria-hidden="true" title="Admin ƒë√£ th·∫£ tim">‚ô• Admin</span>
                    </div>
                `;
            }
            return '';
        }

        function renderComments() {
            const start = (currentPage - 1) * commentsPerPage;
            const end = start + commentsPerPage;
            const pageComments = comments.slice(start, end);

            const commentsList = document.getElementById('comments-list');

            if (comments.length === 0) {
                commentsList.innerHTML = '<div class="empty-state">Ch∆∞a c√≥ g√≥p √Ω n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n g√≥p √Ω!</div>';
            } else {
                commentsList.innerHTML = pageComments.map(comment => `
                    <div class="comment-item">
                        <div class="comment-main">
                            <div class="comment-header">
                                <span class="comment-author">${escapeHtml(comment.username)}</span>
                                <span class="comment-date">${comment.date}</span>
                            </div>
                            <div class="comment-text">${escapeHtml(comment.text)}</div>
                        </div>
                        ${renderHeartControls(comment)}
                    </div>
                `).join('');
            }

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(comments.length / commentsPerPage);
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let html = '';

            html += `<button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚Üê</button>`;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += `<span class="pagination-ellipsis">...</span>`;
                }
            }

            html += `<button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>‚Üí</button>`;

            pagination.innerHTML = html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(comments.length / commentsPerPage);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderComments();
            document.getElementById('comments-list').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ===== Admin UI + API =====
        function syncAdminUI() {
            const dot = document.getElementById('admin-dot');
            const text = document.getElementById('admin-text');
            dot.classList.toggle('on', isAdmin);
            if (text) text.textContent = isAdmin ? 'Admin ‚úì' : 'Admin';

            // modal state
            const sub = document.getElementById('admin-sub');
            const pwWrap = document.getElementById('pw-wrap');
            const loginBtn = document.getElementById('admin-login-btn');
            const logoutBtn = document.getElementById('admin-logout-btn');

            sub.textContent = isAdmin ? 'B·∫°n ƒëang ƒëƒÉng nh·∫≠p admin' : 'ƒêƒÉng nh·∫≠p ƒë·ªÉ m·ªü kh√≥a t√≠nh nƒÉng';
            pwWrap.style.display = isAdmin ? 'none' : '';
            loginBtn.style.display = isAdmin ? 'none' : '';
            logoutBtn.style.display = isAdmin ? '' : 'none';
        }

        function openAdminModal() {
            document.getElementById('admin-modal').classList.add('open');
            document.getElementById('admin-modal').setAttribute('aria-hidden', 'false');
            document.getElementById('admin-note').textContent = '';
            if (!isAdmin) {
                document.getElementById('admin-password').value = '';
                setTimeout(() => document.getElementById('admin-password').focus(), 50);
            }
            syncAdminUI();
        }

        function closeAdminModal() {
            document.getElementById('admin-modal').classList.remove('open');
            document.getElementById('admin-modal').setAttribute('aria-hidden', 'true');
        }

        async function adminLogin() {
            const pw = document.getElementById('admin-password').value;
            const note = document.getElementById('admin-note');
            note.textContent = '';

            try {
                const res = await fetch(`${API_BASE}/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: pw })
                });
                const data = await res.json().catch(() => ({}));

                if (res.ok && (data.ok || data.success) && data.token) {
                    adminToken = data.token;
                    localStorage.setItem('admin_token', adminToken);
                    isAdmin = true;

                    note.textContent = 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng.';
                    syncAdminUI();
                    renderComments();
                } else {
                    note.textContent = data.error || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i';
                }
            } catch (e) {
                note.textContent = 'Kh√¥ng th·ªÉ ƒëƒÉng nh·∫≠p. Vui l√≤ng th·ª≠ l·∫°i.';
            }
        }

        async function adminLogout() {
            const note = document.getElementById('admin-note');
            note.textContent = '';

            adminToken = '';
            localStorage.removeItem('admin_token');
            isAdmin = false;

            note.textContent = 'ƒê√£ ƒëƒÉng xu·∫•t.';
            syncAdminUI();
            renderComments();
        }

        async function toggleHeart(id) {
            if (!isAdmin || !adminToken) return;

            try {
                const res = await fetch(`${API_BASE}/comments/${id}/toggle-heart`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                const data = await res.json().catch(() => ({}));

                if (res.ok && (data.ok || data.success)) {
                    await loadComments();
                } else {
                    alert('L·ªói: ' + (data.error || 'Kh√¥ng th·ªÉ th·∫£ tim'));
                }
            } catch (e) {
                alert('Kh√¥ng th·ªÉ th·∫£ tim. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }

        async function deleteComment(id, btnEl) {
            if (!isAdmin || !adminToken) return;

            const ok = confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a g√≥p √Ω n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.');
            if (!ok) return;

            // UX: disable button while deleting
            if (btnEl) {
                btnEl.disabled = true;
                btnEl.textContent = 'ƒêang x√≥a...';
            }

            const headers = { 'Authorization': `Bearer ${adminToken}` };

            // Try the most standard REST endpoint first
            try {
                let res = await fetch(`${API_BASE}/comments/${id}`, { method: 'DELETE', headers });
                let data = await res.json().catch(() => ({}));

                // Fallbacks if backend uses different route/method
                if (!res.ok) {
                    // Some backends use POST for delete
                    res = await fetch(`${API_BASE}/comments/${id}/delete`, { method: 'POST', headers });
                    data = await res.json().catch(() => ({}));
                }

                if (res.ok && (data.ok || data.success || data.deleted || data.result === 'ok')) {
                    // If current page becomes empty after delete, step back one page safely
                    await loadComments();
                    const totalPages = Math.max(1, Math.ceil(comments.length / commentsPerPage));
                    if (currentPage > totalPages) currentPage = totalPages;
                    renderComments();
                } else {
                    alert('L·ªói: ' + (data.error || 'Kh√¥ng th·ªÉ x√≥a g√≥p √Ω'));
                }
            } catch (e) {
                alert('Kh√¥ng th·ªÉ x√≥a g√≥p √Ω. Vui l√≤ng th·ª≠ l·∫°i!');
            } finally {
                if (btnEl) {
                    btnEl.disabled = false;
                    btnEl.textContent = 'üóë X√≥a';
                }
            }
        }


        // Bind events
        document.getElementById('admin-btn').addEventListener('click', openAdminModal);
        document.getElementById('admin-close').addEventListener('click', closeAdminModal);
        document.getElementById('admin-modal').addEventListener('click', (e) => {
            if (e.target && e.target.id === 'admin-modal') closeAdminModal();
        });
        document.getElementById('admin-login-btn').addEventListener('click', adminLogin);
        document.getElementById('admin-logout-btn').addEventListener('click', adminLogout);
        document.getElementById('admin-password').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') adminLogin();
            if (e.key === 'Escape') closeAdminModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeAdminModal();
        });


// ===== Admin Announcement Popup (HARDCODE) =====
(function initAnnouncementPopup(){
    const KEY = 'announcement_closed_session_v1'; // ƒë·ªïi t√™n key n·∫øu mu·ªën popup hi·ªán l·∫°i
    const modal = document.getElementById('announce-modal');
    const btnClose = document.getElementById('announce-close');
    const btnOk = document.getElementById('announce-ok');

    if (!modal) return;

    function closePopup(){
        modal.classList.add('is-hidden');
        modal.setAttribute('aria-hidden', 'true');
        // Kh√¥ng hi·ªán l·∫°i trong phi√™n (tab) hi·ªán t·∫°i
        try { sessionStorage.setItem(KEY, '1'); } catch(e) {}
    }

    // ·∫®n n·∫øu ƒë√£ ƒë√≥ng trong session
    try {
        if (sessionStorage.getItem(KEY) === '1') {
            modal.classList.add('is-hidden');
            modal.setAttribute('aria-hidden', 'true');
            return;
        }
    } catch(e) {}

    // Click outside to close
    modal.addEventListener('click', (e) => {
        if (e.target && e.target.id === 'announce-modal') closePopup();
    });

    if (btnClose) btnClose.addEventListener('click', closePopup);
    if (btnOk) btnOk.addEventListener('click', closePopup);

    // ESC closes (avoid interfering with admin modal logic)
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !modal.classList.contains('is-hidden')) closePopup();
    });
})();
// =============================================

        loadComments();
    </script>
</body>
</html>
